# OshiTalk 要件定義書

## 概要
OshiTalkは、インフルエンサーとファンをつなぐ、オークション形式のビデオ通話プラットフォームです。

## サービスコンセプト
- インフルエンサーが提供するTalk枠（通話枠）をオークション形式で販売
- ファンは入札または即決購入でTalk枠を獲得
- 予定時刻になったらビデオ通話を実施

## 主要機能一覧

### 1. オークション機能 ([詳細](./auction.md))
- Talk枠のオークション出品
- リアルタイム入札
- 即決購入（Buy Now）
- オークション終了処理
- 落札者決定

### 2. Talk（通話）機能 ([詳細](./talk.md))
- Talk枠の作成・管理
- 予約管理
- ビデオ通話実施
- Talk履歴

### 3. 決済・カード登録機能 ([詳細](./payment.md))
- Stripe連携
- カード情報登録
- 与信確保（Authorization）
- 決済処理（Capture）
- 返金処理

### 4. ユーザー認証機能 ([詳細](./authentication.md))
- Supabase Auth連携
- メール認証
- Googleログイン
- ユーザープロフィール管理

### 5. インフルエンサー管理機能 ([詳細](./influencer.md))
- インフルエンサーダッシュボード
- Talk枠作成
- 売上管理
- スケジュール管理

### 6. フォロー機能 ([詳細](./follow.md))
- インフルエンサーフォロー
- フォロー中のTalk枠優先表示
- フォロワー数表示

### 7. ランキング機能 ([詳細](./ranking.md))
- インフルエンサーランキング
- Talk枠人気ランキング
- 売上ランキング

## 技術スタック

### フロントエンド
- React 18
- TypeScript
- Vite
- TailwindCSS
- React Router

### バックエンド
- Node.js / Express
- TypeScript
- Supabase (PostgreSQL)
- Stripe API

### インフラ
- Heroku (本番環境)
- Supabase (DB・認証・ストレージ)

## データモデル

### 主要テーブル
- `users` - ユーザー情報
- `call_slots` - Talk枠
- `auctions` - オークション
- `bids` - 入札履歴
- `purchased_slots` - 購入済みTalk枠
- `follows` - フォロー関係

## ユーザーフロー

### ファンの利用フロー
1. サービス閲覧（未ログイン可）
2. 気になるTalk枠を発見
3. 新規登録・ログイン
4. カード情報登録
5. 入札または即決購入
6. オークション終了・落札
7. Talk予定時刻に通話実施

### インフルエンサーの利用フロー
1. 新規登録・ログイン
2. インフルエンサーダッシュボードへ
3. Talk枠作成（タイトル、説明、日時、価格設定）
4. オークション開始
5. オークション終了・落札者決定
6. Talk予定時刻に通話実施
7. 売上確認

## ビジネスルール

### オークションルール
- 最低価格（starting_price）からスタート
- 入札単位（minimum_bid_increment）で入札
- 即決価格（buy_now_price）設定可能（任意）
- オークション終了時刻（auction_end_time）で自動終了
- 最高入札者が落札

### 決済ルール
- 入札時に与信確保（Authorization）
- 落札時に決済確定（Capture）
- 落札できなかった場合は与信解放
- 即決購入時は即座に決済確定

### Talk実施ルール
- 予定時刻の前後30分に通話可能
- 予定時刻を過ぎると自動的に完了ステータスへ
- 通話時間は設定された duration_minutes に従う

## 優先順位・表示ルール

### Topページの表示順
1. オークション開催中（active）を終了済み（ended）より優先
2. 開催中の中で、フォロー中のインフルエンサーを優先
3. 各グループ内で、終了時刻が近い順

### 日時表示
- タイムゾーン: Asia/Tokyo (JST)
- フォーマット: YYYY/MM/DD HH:MM

## セキュリティ・プライバシー

### 認証
- Supabase Auth による認証
- JWTトークンによるセッション管理

### 決済
- Stripeによる安全な決済処理
- カード情報はStripeで保管（自社DBに保存しない）
- PCI DSS準拠

### データ保護
- ユーザー個人情報の暗号化
- HTTPS通信の強制
- CORS設定によるAPI保護

## 今後の拡張予定
- 自動入札機能
- Talk録画機能
- レビュー・評価機能
- メッセージング機能
- プッシュ通知
